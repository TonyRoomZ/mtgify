!function(){return function t(e,n,r){function s(o,a){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[o]={exports:{}};e[o][0].call(u.exports,function(t){var n=e[o][1][t];return s(n||t)},u,u.exports,t,e,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}}()({1:[function(t,e,n){"use strict";const r=t("./DeckList"),s=t("./HoverCard"),i=t("./CardAPI");let o=0;class a extends HTMLElement{connectedCallback(){this.setAttribute("data-autocard-id",o++),this.onInitTextListener();const t=this;t._observer=new MutationObserver(function(e){const n=e[0].addedNodes[0];n&&"#text"===n.nodeName&&(t._observer.disconnect(),n.remove(),t.handleInnerText(n.textContent))}),t._observer.observe(t,{childList:!0})}uuid(){return this.getAttribute("data-autocard-id")}queryOther(t){return document.querySelector(`*[data-autocard-id="${t}"`)}onInitTextListener(){}handleInnerText(t){}}class c extends a{onInitTextListener(){this.anchor=document.createElement("a"),this.anchor.setAttribute("target","_blank");const t=this.getAttribute("name");t&&this.loadCardByName(t)}handleInnerText(t){this.customText=t,this.cardName?this.loadCardByName(this.cardName):this.loadCardByName(t)}loadCardByName(t){this.cardName=t.trim(),this.innerHTML="",this.appendChild(this.anchor);const e=`http://magiccards.info/query?q=${this.cardName}`;this.anchor.setAttribute("href",e);let n=void 0!==this.customText?this.customText:this.cardName;const r=this.getAttribute("quantity");r&&(n=`${r}x ${n}`),this.anchor.innerHTML=n,this.onInitAutoCard()}getCardInfo(){return i.getCardInfo(this.cardName)}onInitAutoCard(){}}class d extends c{onInitAutoCard(){const t=this;t.getCardInfo().then(e=>t.loadCardImage(e))}loadCardImage(t){const e=document.createElement("img");e.setAttribute("src",t.imgUrl),e.setAttribute("alt",t.name),e.setAttribute("title",t.name),this.anchor.innerHTML="",this.anchor.appendChild(e),this.image=e}}customElements.define("card-text",class extends c{onInitAutoCard(){this.onmouseover=(t=>this.onMouseOver(t)),this.onmouseout=(t=>this.onMouseOut(t)),this.imagePreviewId=this.getAttribute("data-preview");const t=this.getPreview();t&&t.loadDefault(this)}getPreview(){const{imagePreviewId:t}=this;return t?this.queryOther(t):null}getImageController(){return this.getPreview()||s}onMouseOver(t){this.getImageController().show(this,t)}onMouseOut(t){this.getImageController().hide(this,t)}}),customElements.define("card-image",d),customElements.define("card-list",class extends a{onInitTextListener(){const t=this.getAttribute("src");this.listTitle=document.createElement("card-list-title"),this.container=document.createElement("card-list-container"),this.appendChild(this.listTitle),this.appendChild(this.container),this.hasAttribute("preview")&&(this.preview=document.createElement("card-list-preview")),this.renderText(t)}renderText(t){const e=this;e.listTitle.innerHTML=this.getAttribute("name"),e.container.innerHTML="loading deck list...",r.DeckListFromUrl(t,{},t=>i.getCardInfo(t)).then(t=>{e.container.innerHTML="",e.preview&&e.container.appendChild(e.preview),t.forEach(t=>{const n=document.createElement("card-list-category"),r=document.createElement("card-list-category-title");r.innerHTML=t.type,n.appendChild(r),t.cards.forEach(t=>{const r=document.createElement("card-text");n.appendChild(r),r.setAttribute("name",t.card.name),r.setAttribute("quantity",t.quantity),e.preview&&r.setAttribute("data-preview",e.preview.uuid())}),e.container.appendChild(n)})})}}),customElements.define("card-list-title",class extends HTMLElement{}),customElements.define("card-list-container",class extends HTMLElement{}),customElements.define("card-list-preview",class extends d{loadDefault(t){this.cardName||this.loadCardByName(t.cardName)}show(t,e){this.loadCardByName(t.cardName)}hide(t,e){}}),customElements.define("card-list-category",class extends HTMLElement{}),customElements.define("card-list-category-title",class extends HTMLElement{}),e.exports={}},{"./CardAPI":2,"./DeckList":4,"./HoverCard":5}],2:[function(t,e,n){"use strict";const r=t("./Config"),s=new class{constructor(){const t=this;t.lookupInfo=new Promise((e,n)=>{t.resolveInfo=(t=>e(t))}),window.fetch(`${r().apiUrl}/json/CardInfo.lower.json`).then(t=>t.json()).then(e=>t.resolveInfo(e))}normalizeCardName(t){return t.trim().toLowerCase()}performLookup(t,e){return t[this.normalizeCardName(e)]}getCardInfo(t){const e=this;return e.lookupInfo.then(n=>e.performLookup(n,t)).then(t=>{const e=r().isTest?"CardImage.jpg":`http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=${t.mid}&type=card`;return{...t,imgUrl:e}})}};e.exports=s},{"./Config":3}],3:[function(t,e,n){"use strict";e.exports=(t=>({isTest:(t=t||window).AUTOCARD_TEST||!1,apiUrl:t.AUTOCARD_API||"http://autocard.mpaulweeks.com"}))},{}],4:[function(t,e,n){"use strict";const r=["Land","Creature","Artifact","Enchantment","Planeswalker","Instant","Sorcery"].reverse(),s=["Creature","Planeswalker","Artifact","Enchantment","Instant","Sorcery","Land"];class i{constructor(t,e,n){this.text=t,this.options=e,this.cardLookup=n}categorizeCardList(){const{text:t,cardLookup:e}=this,n=[];return t.split("\n").forEach(t=>{const s=t.trim();if(0===s.length)return;const i=s.indexOf("x "),o=s.substring(0,i),a=s.substring(i+2),c=e(a).then(e=>{if(!e)return console.log("failed to find card",t),null;let n="unknown";return r.forEach(t=>{e.types.includes(t)&&(n=t)}),{quantity:o,type:n,card:e}});n.push(c)}),Promise.all(n).then(t=>this.processData(t))}processData(t){const{options:e}=this;e.reverse&&(t=t.reverse());const n={};return t.forEach(t=>{null!==t&&(n[t.type]||(n[t.type]=[]),n[t.type].push(t))}),n}getDataPromise(){return this.categorizeCardList().then(t=>{const e=[];return s.forEach(n=>{t[n]&&e.push({type:n,cards:t[n]})}),e})}}e.exports={DeckList:i,DeckListFromUrl:function(t,e,n){return fetch(t).then(t=>t.text()).then(t=>new i(t,e,n).getDataPromise())}}},{}],5:[function(t,e,n){const r=311,s=220,i=document.createElement("div");i.style="display: none; position: absolute;",document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(i)});const o=document.createElement("img");o.onerror="this.onerror=null;this.onmouseout=null;this.onmouseover=null;hideImgPopup();",o.width=s,o.height=r,i.appendChild(o),e.exports={show:function(t,e){t.getCardInfo().then(n=>{i.setAttribute("data-mid",n.mid),i.style.top=`${function(t,e){const n=t.offsetHeight;let s=t.offsetTop+n,i=t;for(;null!=i.offsetParent;)s+=null==(i=i.offsetParent).offsetTop?0:i.offsetTop;return screen.height/2<e.screenY&&(s-=r+n),s}(t,e)}px`,i.style.left=`${function(t,e){let n=e.screenX+10;return document.body.offsetWidth/2<e.screenX&&(n-=s+20),n}(0,e)}px`,o.src="",o.src=n.imgUrl,i.style.display="block"})},hide:function(t,e){t.getCardInfo().then(t=>{i.getAttribute("data-mid")===String(t.mid)&&(i.style.display="none")})},move:function(t,e){}}},{}],6:[function(t,e,n){t("./AutoCard.js")},{"./AutoCard.js":1}]},{},[6]);