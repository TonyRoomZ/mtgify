!function(){return function t(e,n,r){function s(i,a){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return s(n||t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}}()({1:[function(t,e,n){"use strict";const r=t("./DeckList"),s=t("./HoverCard"),o=new(t("./CardAPI"));let i=0;class a extends HTMLElement{connectedCallback(){this.setAttribute("data-autocard-id",i++),this.onInitTextListener();const t=this;t._observer=new MutationObserver(function(e){const n=e[0].addedNodes[0];n&&"#text"===n.nodeName&&(t._observer.disconnect(),n.remove(),t.handleInnerText(n.textContent))}),t._observer.observe(t,{childList:!0})}uuid(){return this.getAttribute("data-autocard-id")}queryOther(t){return document.querySelector(`*[data-autocard-id="${t}"`)}onInitTextListener(){}handleInnerText(t){}}class c extends a{onInitTextListener(){this.anchor=document.createElement("a"),this.anchor.setAttribute("target","_blank");const t=this.getAttribute("name");t&&this.loadCardByName(t)}handleInnerText(t){this.customText=t,this.cardName?this.loadCardByName(this.cardName):this.loadCardByName(t)}loadCardByName(t){this.cardName=t.trim(),this.innerHTML="",this.appendChild(this.anchor);const e=`http://magiccards.info/query?q=${this.cardName}`;this.anchor.setAttribute("href",e);let n=void 0!==this.customText?this.customText:this.cardName;const r=this.getAttribute("quantity");r&&(n=`${r}x ${n}`),this.anchor.innerHTML=n,this.onInitAutoCard()}getCardInfo(){return o.getCardInfo(this.cardName)}onInitAutoCard(){}}class d extends c{onInitAutoCard(){const t=this;t.getCardInfo().then(e=>t.loadCardImage(e))}loadCardImage(t){const e=document.createElement("img");e.setAttribute("src",t.imgUrl),e.setAttribute("alt",t.name),e.setAttribute("title",t.name),this.anchor.innerHTML="",this.anchor.appendChild(e),this.image=e}}customElements.define("card-text",class extends c{onInitAutoCard(){this.onmouseover=(t=>this.onMouseOver(t)),this.onmouseout=(t=>this.onMouseOut(t)),this.imagePreviewId=this.getAttribute("data-preview");const t=this.getPreview();t&&t.loadDefault(this)}getPreview(){const{imagePreviewId:t}=this;return t?this.queryOther(t):null}getImageController(){return this.getPreview()||s}onMouseOver(t){this.getImageController().show(this,t)}onMouseOut(t){this.getImageController().hide(this,t)}}),customElements.define("card-image",d),customElements.define("card-list",class extends a{onInitTextListener(){const t=this.getAttribute("src");this.listTitle=document.createElement("card-list-title"),this.container=document.createElement("card-list-container"),this.appendChild(this.listTitle),this.appendChild(this.container),this.listTitle.innerHTML=this.getAttribute("name"),this.hasAttribute("collapse")?this.renderHidden():this.renderFull(t)}renderHidden(){this.container.innerHTML=""}renderFull(t){const e=this;e.container.innerHTML="loading deck list...",r.DeckListFromUrl(t,{},o).then(t=>{e.container.innerHTML="";const n=e.hasAttribute("preview")?document.createElement("card-list-preview"):null;n&&e.container.appendChild(n),t.forEach(t=>{const r=document.createElement("card-list-category"),s=document.createElement("card-list-category-title");s.innerHTML=t.type,r.appendChild(s),t.cards.forEach(t=>{const e=document.createElement("card-text");r.appendChild(e),e.setAttribute("name",t.card.name),e.setAttribute("quantity",t.quantity),n&&e.setAttribute("data-preview",n.uuid())}),e.container.appendChild(r)})})}}),customElements.define("card-list-title",class extends HTMLElement{}),customElements.define("card-list-container",class extends HTMLElement{}),customElements.define("card-list-preview",class extends d{loadDefault(t){this.cardName||this.loadCardByName(t.cardName)}show(t,e){this.loadCardByName(t.cardName)}hide(t,e){}}),customElements.define("card-list-category",class extends HTMLElement{}),customElements.define("card-list-category-title",class extends HTMLElement{}),e.exports={}},{"./CardAPI":2,"./DeckList":5,"./HoverCard":6}],2:[function(t,e,n){"use strict";const r=t("./Config"),s=t("./Compressor");e.exports=class{constructor(){const t=this;t.lookupPromise=new Promise((e,n)=>{t.resolveLookup=(n=>{const r=s.decompressArray(n),o=t.createLookup(r);e(o)})}),window.fetch(`${r().apiUrl}/json/CardInfo.compressed.json`).then(t=>t.json()).then(e=>t.resolveLookup(e))}normalizeCardName(t){return t.trim().toLowerCase()}performLookup(t,e){return t[this.normalizeCardName(e)]}createLookup(t){const e=this,n={};return t.forEach(t=>{n[e.normalizeCardName(t.name)]=t}),n}getCardInfo(t){const e=this;return e.lookupPromise.then(n=>e.performLookup(n,t)).then(t=>{const e=`http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=${t.mid}&type=card`,n=t.mciSet&&t.mciNum?`https://magiccards.info/scans/en/${t.mciSet}/${t.mciNum}.jpg`:null,s=r().isTest?"CardImage.jpg":n||e;return{...t,imgUrl:s}})}}},{"./Compressor":3,"./Config":4}],3:[function(t,e,n){"use strict";e.exports={compressArray:function(t){const e={};t.forEach(t=>{for(let n in t)e[n]=!0});const n=[];for(let t in e)n.push(t);n.sort();const r={};n.forEach((t,e)=>{r[t]=e});const s=[];return t.forEach(t=>{const e=[];for(let n in t)e[r[n]]=t[n];s.push(e)}),{key:n,arr:s}},decompressArray:function(t){const e=t.key;return t.arr.map(t=>{const n={};return t.map((t,r)=>{n[e[r]]=t}),n})}}},{}],4:[function(t,e,n){"use strict";e.exports=(t=>({isTest:(t=t||window).AUTOCARD_TEST||!1,apiUrl:t.AUTOCARD_API||"http://autocard.mpaulweeks.com"}))},{}],5:[function(t,e,n){"use strict";const r=["Land","Creature","Artifact","Enchantment","Planeswalker","Instant","Sorcery"].reverse(),s=["Creature","Planeswalker","Artifact","Enchantment","Instant","Sorcery","Land"];class o{constructor(t,e,n){this.text=t,this.options=e,this.cardApi=n}categorizeCardList(){const{text:t,cardApi:e}=this,n=[];return t.split("\n").forEach(t=>{const s=t.trim();if(0===s.length)return;const o=s.indexOf("x "),i=s.substring(0,o),a=s.substring(o+2),c=e.getCardInfo(a).then(e=>{if(!e)return console.log("failed to find card",t),null;let n="unknown";return r.forEach(t=>{e.types.includes(t)&&(n=t)}),{quantity:i,type:n,card:e}});n.push(c)}),Promise.all(n).then(t=>this.processData(t))}processData(t){const{options:e}=this;e.reverse&&(t=t.reverse());const n={};return t.forEach(t=>{null!==t&&(n[t.type]||(n[t.type]=[]),n[t.type].push(t))}),n}getDataPromise(){return this.categorizeCardList().then(t=>{const e=[];return s.forEach(n=>{t[n]&&e.push({type:n,cards:t[n]})}),e})}}e.exports={DeckList:o,DeckListFromUrl:function(t,e,n){return fetch(t).then(t=>t.text()).then(t=>new o(t,e,n).getDataPromise())}}},{}],6:[function(t,e,n){const r=310,s=223,o=document.createElement("div");o.style="display: none; position: absolute;",document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(o)});const i=document.createElement("img");i.onerror="this.onerror=null;this.onmouseout=null;this.onmouseover=null;hideImgPopup();",i.width=s,i.height=r,o.appendChild(i),e.exports={show:function(t,e){t.getCardInfo().then(n=>{o.setAttribute("data-mid",n.mid),o.style.top=`${function(t,e){const n=t.offsetHeight;let s=t.offsetTop+n,o=t;for(;null!=o.offsetParent;)s+=null==(o=o.offsetParent).offsetTop?0:o.offsetTop;return screen.height/2<e.screenY&&(s-=r+n),s}(t,e)}px`,o.style.left=`${function(t,e){let n=e.screenX+10;return document.body.offsetWidth/2<e.screenX&&(n-=s+20),n}(0,e)}px`,i.src="",i.src=n.imgUrl,o.style.display="block"})},hide:function(t,e){t.getCardInfo().then(t=>{o.getAttribute("data-mid")===String(t.mid)&&(o.style.display="none")})},move:function(t,e){}}},{}],7:[function(t,e,n){t("./AutoCard.js")},{"./AutoCard.js":1}]},{},[7]);